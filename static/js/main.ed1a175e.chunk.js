(this["webpackJsonpfushigi-user-interface"]=this["webpackJsonpfushigi-user-interface"]||[]).push([[0],{143:function(e,t){},145:function(e,t){},147:function(e,t){},148:function(e,t){},149:function(e,t){},150:function(e,t){},194:function(e,t,n){},319:function(e,t,n){},346:function(e,t){},355:function(e,t,n){},356:function(e,t,n){"use strict";n.r(t);var r=n(7),c=n.n(r),o=n(136),a=n.n(o),i=(n(189),n(192),n(2)),s=n.n(i),u=n(60),l=(n(194),n(84)),d=n(27),f=n(85),h=n(16),b=n(24),j=function(){var e=Object(r.useReducer)((function(e,t){switch(t.type){case"set":return t.payload;case"reset":return 0;default:throw new Error("Unexpected action")}}),0),t=Object(b.a)(e,2),n=t[0],c=t[1],o=Object(r.useRef)(0);Object(r.useEffect)((function(){o.current=n}),[n]);return{playSound:function(e){var t=new AudioContext,n=new Audio(e);n.play().then((function(){var e,r=n.captureStream(),o=t.current.createAnalyser(),a=t.current.createMediaStreamSource(r),i=new Float32Array(o.fftSize);a.connect(o);!function t(){o.getFloatTimeDomainData(i);var n,r=0,a=Object(h.a)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value;r+=s*s}}catch(u){a.e(u)}finally{a.f()}c({type:"set",payload:(5*Math.sqrt(r/i.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),n.addEventListener("ended",(function(){a.disconnect(),o.disconnect(),cancelAnimationFrame(e),n.pause(),n.removeAttribute("src"),n.remove(),c({type:"reset"})}))}))},playSoundBeta:function(e,t){return new Promise((function(n,r){var o=new AudioContext,a=new Audio('http://localhost:5252/api/tts?text="'.concat(e,'"'));a.crossOrigin="anonymous",a.preload="auto",o.resume().then(a.play().then((function(){t(e);var i,s=a.captureStream(),u=o.createAnalyser(),l=o.createMediaStreamSource(s),d=new Float32Array(u.fftSize);l.connect(u);!function e(){u.getFloatTimeDomainData(d);var t,n=0,r=Object(h.a)(d);try{for(r.s();!(t=r.n()).done;){var o=t.value;n+=o*o}}catch(a){r.e(a)}finally{r.f()}c({type:"set",payload:(5*Math.sqrt(n/d.length)).toFixed(1)}),i=requestAnimationFrame(e)}(),a.addEventListener("ended",(function(){t(""),l.disconnect(),u.disconnect(),cancelAnimationFrame(i),a.pause(),a.removeAttribute("src"),a.remove(),c({type:"reset"}),n()})),a.addEventListener("error",(function(){r()}))})))}))},playSoundOmega:function(e,t,n){return new Promise((function(r,o){var a=new AudioContext;e.then((function(e){var i=new Blob([e],{type:"audio/wav"}),s=new Audio(window.URL.createObjectURL(i));s.play().then((function(){n(t);var e,i=s.captureStream(),u=a.createAnalyser(),l=a.createMediaStreamSource(i),d=new Float32Array(u.fftSize);l.connect(u);!function t(){u.getFloatTimeDomainData(d);var n,r=0,o=Object(h.a)(d);try{for(o.s();!(n=o.n()).done;){var a=n.value;r+=a*a}}catch(i){o.e(i)}finally{o.f()}c({type:"set",payload:(5*Math.sqrt(r/d.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),s.addEventListener("ended",(function(){n(""),l.disconnect(),u.disconnect(),cancelAnimationFrame(e),s.pause(),s.removeAttribute("src"),s.remove(),c({type:"reset"}),r()})),s.addEventListener("error",(function(){o()}))}))}))}))},getAudioLevel:function(){return o.current}}},m=n(137),p=n.n(m),O=(n(319),n(10)),g=function(e){return Object(O.jsx)("div",{className:"subtitle-text mx-auto text-center",children:Object(O.jsx)("p",{children:""!==e.text?Object(O.jsx)("span",{children:e.text}):null})})},v=n(64),y=n(138),x=n.n(y),w=function(){return null},S=["error","connect_error","connect_timeout","reconnect_error","reconnect_failed","disconnect"],A=function(e){var t=e.sockUrl,n=e.sockOpts,c=e.initSessionId,o=e.initMsg,a=e.onError,i=void 0===a?w:a,l=e.onUtter,d=void 0===l?w:l,f=Object(r.useRef)(null),h=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=t.match(/^((?:http|ws)s?:\/\/[^/]+)(\/.*)$/),r=Object(b.a)(e,3),a=r[1],s=r[2],u=x()(a,Object(v.a)({path:s},n));return f.current=u,S.forEach((function(e){return u.on(e,(function(t){"disconnect"===e&&"io client disconnect"===t||i({type:e,payload:t})}))})),u.on("connect",(function(){return j(u,c)})).on("session_confirm",(function(e){h.current=e,console.log("New session created! : "+h.current+"/"+e),o&&g(o)})).on("bot_uttered",g),function(){return u.close()}}),[]);var j=Object(r.useCallback)((function(e,t){return f.current.emit("session_request",{session_id:t})}),[]),m=function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.current,e.next=3,t.close();case 3:return e.next=5,t.open();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=Object(r.useCallback)((function(e,t){f.current.emit("user_uttered",{session_id:h.current,message:t||e})}),[]),O=Object(r.useCallback)((function(e){p(e)}),[p]),g=Object(r.useCallback)((function(e){var t={ts:Date.now(),direction:"in",metadata:e.metadata};d(Object(v.a)(Object(v.a)({},t),e))}),[d]);return{send:O,botUtter:g,restartSession:j,triggerRestartSession:m}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null},n=Object(r.useState)(null),c=Object(b.a)(n,2),o=c[0],a=c[1],i=Object(r.useState)(null),s=Object(b.a)(i,2),u=s[0],l=s[1],d=Object(r.useReducer)((function(e,t){switch(t.type){case"start":return!0;case"stop":return!1;default:throw new Error("Unexpected action")}}),!1,void 0),f=Object(b.a)(d,2),h=f[0],j=f[1],m=Object(r.useRef)(!1);Object(r.useEffect)((function(){m.current=h}),[h]),Object(r.useEffect)((function(){if("speechSynthesis"in window)try{var n=new("undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition));a(n),n.onstart=function(){console.log("Voice recognition started."),j({type:"start"})},n.onresult=function(t){for(var n="",r=t.resultIndex;r<t.results.length;++r)t.results[r].isFinal&&(n+=t.results[r][0].transcript);j({type:"stop"}),console.log("Final result: "+n),l(n),e(n)},n.onnomatch=function(){console.log("No match found."),t()},n.onerror=function(){console.log("No match found."),t()},a(n)}catch(r){console.log(r)}else console.log("Speech recognition not supported \ud83d\ude22")}),[]);var p=function(){o.start()},O=function(){return m.current};return{recognition:o,transcript:u,startRecognize:p,getListening:O}},R=n(139),M=n(365),N=n(364),E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=Object(R.a)({concurrency:1}),n=t.add,c=Object(r.useState)(0),o=Object(b.a)(c,2),a=o[0],i=o[1],s=Object(r.useState)(""),u=Object(b.a)(s,2),l=u[0],d=u[1],f=Object(r.useRef)(0),h=Object(r.useRef)("");Object(r.useEffect)((function(){f.current=a}),[a]),Object(r.useEffect)((function(){h.current=l}),[l]);var j=function(){return f.current},m=function(){return h.current},p=function(){i(a+1)},O=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";p(),n({id:j(),task:function(){return e(g(t),t,d)}})},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise((function(t,n){var r=M.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),c=new N.a(r,null);c.speakTextAsync(e,(function(e){c.close(),t(e.audioData)}),(function(e){console.log(e),c.close(),n(e)}))}))};return{speakSynthesis:O,getText:m}},F=function(e){var t=A({sockUrl:"http://localhost:5005/socket.io/",sockOpts:{transports:["websocket"]},onUtter:function(e){a(e.text)}}),n=t.send,r=t.triggerRestartSession,c=k((function(e){n(e)}),(function(){a("I am sorry. I cannot hear you. Please speak louder and clearer.")})).startRecognize,o=E(e),a=o.speakSynthesis;return{getText:o.getText,startRecognize:c,triggerRestartSession:r}},C=(n(355),function(){return Object(O.jsx)("div",{className:"cheat-card",children:Object(O.jsx)("div",{className:"card",children:Object(O.jsxs)("div",{className:"card-body",children:[Object(O.jsx)("h5",{className:"card-title",children:"Cheat Sheet"}),Object(O.jsx)("h6",{className:"card-subtitle mb-2 text-muted",children:"Quick guide to get started using the system"}),Object(O.jsxs)("ul",{className:"list-group card-text",children:[Object(O.jsxs)("li",{className:"list-group-item",children:[Object(O.jsx)("h6",{children:"What...?"}),Object(O.jsx)("p",{className:"small",children:"Ask the explanation of many things related to the CS School such as the current Dean, computer science meaning or major subjects."})]}),Object(O.jsxs)("li",{className:"list-group-item",children:[Object(O.jsx)("h6",{children:"Where...?"}),Object(O.jsx)("p",{className:"small",children:"Ask the direction to many places in the CS School such as Dean's Office, School Office or Surau."})]}),Object(O.jsxs)("li",{className:"list-group-item",children:[Object(O.jsx)("h6",{children:"Why / How...?"}),Object(O.jsx)("p",{className:"small",children:"Inquiry about many subjects about the CS School such as the reasoning behind internship programme, graduate requirements or and others."})]})]})]})})})});l.a.registerPlugin(d.b),f.Live2DModel.registerTicker(d.a);var D=function(){var e=Object(r.useRef)(),t=Object(r.useRef)(),n=Object(r.useRef)(),c=Object(r.useRef)(),o=j(),a=o.playSoundOmega,i=o.getAudioLevel,d=F(a),h=d.getText,b=d.startRecognize;p()(Object(u.a)(s.a.mark((function r(){return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.current=new l.a({view:t.current,autoStart:!0,backgroundColor:16770974,resizeTo:e.current}),r.next=3,f.Live2DModel.from("Haru/haru_greeter_t03.model3.json").then((function(e){e.scale.set(.3);var t=e.internalModel.motionManager.update;e.internalModel.motionManager.update=function(){for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];t.apply(e.internalModel.motionManager,r),e.internalModel.coreModel.setParameterValueById("ParamMouthOpenY",i())},n.current.stage.addChild(e),c.current=e,n.current.stage.children[0].x=n.current.stage.width/2}));case 3:case"end":return r.stop()}}),r)}))),[]);return Object(O.jsxs)("div",{className:"live2d-viewer",ref:e,children:[Object(O.jsx)("canvas",{ref:t}),Object(O.jsx)(g,{text:h()}),Object(O.jsx)("button",{className:"btn btn-lg btn-primary speak-btn",onClick:function(e){e.preventDefault(),b()},children:"SPEAK"}),Object(O.jsx)(C,{})]})},L=function(){return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)(D,{})})};a.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(L,{})}),document.getElementById("root"))},36:function(e,t){},46:function(e,t){}},[[356,1,2]]]);
//# sourceMappingURL=main.ed1a175e.chunk.js.map