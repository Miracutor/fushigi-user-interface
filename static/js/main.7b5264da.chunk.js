(this["webpackJsonpfushigi-user-interface"]=this["webpackJsonpfushigi-user-interface"]||[]).push([[0],{162:function(e,t){},164:function(e,t){},166:function(e,t){},167:function(e,t){},168:function(e,t){},169:function(e,t){},204:function(e,t,n){},329:function(e,t,n){},355:function(e,t){},364:function(e,t,n){},365:function(e,t,n){"use strict";n.r(t);var c=n(11),r=n.n(c),s=n(157),a=n.n(s),o=(n(199),n(202),n(1)),i=n.n(o),u=n(65),l=n(31),d=(n(204),n(102)),f=n(34),b=n(103),j=n(158),h=n.n(j),g=(n(329),n(12)),m=function(e){return Object(g.jsx)("div",{className:"subtitle-text mx-auto text-center",children:Object(g.jsx)("p",{children:""!==e.text?Object(g.jsx)("span",{children:e.text}):null})})},p=n(71),O=n(159),v=n.n(O),x=function(){return null},y=["error","connect_error","connect_timeout","reconnect_error","reconnect_failed","disconnect"],w=function(e){var t=e.sockUrl,n=e.sockOpts,r=e.initSessionId,s=e.initMsg,a=e.onError,o=void 0===a?x:a,d=e.onUtter,f=void 0===d?x:d,b=Object(c.useRef)(null),j=Object(c.useRef)(null);Object(c.useEffect)((function(){var e=t.match(/^((?:http|ws)s?:\/\/[^/]+)(\/.*)$/),c=Object(l.a)(e,3),a=c[1],i=c[2],u=v()(a,Object(p.a)({path:i},n));return b.current=u,y.forEach((function(e){return u.on(e,(function(t){"disconnect"===e&&"io client disconnect"===t||o({type:e,payload:t})}))})),u.on("connect",(function(){return h(u,r)})).on("session_confirm",(function(e){j.current=e,console.log("New session created! : "+j.current+"/"+e),s&&w(s)})).on("bot_uttered",w),function(){return u.close()}}),[]);var h=Object(c.useCallback)((function(e,t){return b.current.emit("session_request",{session_id:t})}),[]),g=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.current,e.next=3,t.close();case 3:return e.next=5,t.open();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=Object(c.useCallback)((function(e,t){b.current.emit("user_uttered",{session_id:j.current,message:t||e})}),[]),O=Object(c.useCallback)((function(e){m(e)}),[m]),w=Object(c.useCallback)((function(e){var t={ts:Date.now(),direction:"in",metadata:e.metadata};f(Object(p.a)(Object(p.a)({},t),e))}),[f]);return{send:O,botUtter:w,restartSession:h,triggerRestartSession:g}},S=n(379),k=n(370),R=n(380),A=n(75),N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null},n=Object(c.useState)(null),r=Object(l.a)(n,2),s=r[0],a=r[1],o=Object(c.useReducer)((function(e,t){switch(t.type){case"start":return!0;case"stop":return!1;default:throw new Error("Unexpected action")}}),!1,void 0),i=Object(l.a)(o,2),u=i[0],d=i[1],f=Object(c.useRef)(!1);Object(c.useEffect)((function(){f.current=u}),[u]);var b=function(){return new Promise((function(n,c){var r=S.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),s=k.a.fromDefaultMicrophoneInput(),o=new R.a(r,s);console.log("Voice recognition started."),d({type:"start"}),o.recognizeOnceAsync((function(r){var s;r.reason===A.a.RecognizedSpeech?s=r.text:(s="Speech was cancelled or could not be recognized. Ensure your microphone is working properly.",t(),c()),d({type:"stop"}),console.log("Final result: "+s),a(s),e(s),n()}))}))},j=function(){return f.current};return{transcript:s,startRecognize:b,getListening:j}},M=n(20),E=n(170),L=n(378),U=function(){var e=Object(E.a)({concurrency:1}).add,t=Object(c.useState)(0),n=Object(l.a)(t,2),r=n[0],s=n[1],a=Object(c.useState)(""),o=Object(l.a)(a,2),i=o[0],u=o[1],d=Object(c.useReducer)((function(e,t){switch(t.type){case"set":return t.payload;case"reset":return 0;default:throw new Error("Unexpected action")}}),0),f=Object(l.a)(d,2),b=f[0],j=f[1],h=Object(c.useRef)(0),g=Object(c.useRef)(""),m=Object(c.useRef)(0);Object(c.useEffect)((function(){m.current=b}),[b]);Object(c.useEffect)((function(){h.current=r}),[r]),Object(c.useEffect)((function(){g.current=i}),[i]);var p=function(){return h.current},O=function(){s(r+1)},v=function(e){return'<speak version="1.0" xmlns="https://www.w3.org/2001/10/synthesis" xml:lang="en-US">\n  <voice name="en-US-GuyRUS">\n    '.concat(e,"\n  </voice>\n</speak>")},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise((function(t,n){var c=S.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),r=new L.a(c,null);r.speakSsmlAsync(v(e),(function(e){r.close(),t(e.audioData)}),(function(e){console.log(e),r.close(),n(e)}))}))},y=function(e,t){return new Promise((function(n,c){var r=new AudioContext;e.then((function(e){var s=new Blob([e],{type:"audio/wav"}),a=new Audio(window.URL.createObjectURL(s));a.play().then((function(){u(t);var e,s=a.captureStream(),o=r.createAnalyser(),i=r.createMediaStreamSource(s),l=new Float32Array(o.fftSize);i.connect(o);!function t(){o.getFloatTimeDomainData(l);var n,c=0,r=Object(M.a)(l);try{for(r.s();!(n=r.n()).done;){var s=n.value;c+=s*s}}catch(a){r.e(a)}finally{r.f()}j({type:"set",payload:(5*Math.sqrt(c/l.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),a.addEventListener("ended",(function(){u(""),i.disconnect(),o.disconnect(),cancelAnimationFrame(e),a.pause(),a.removeAttribute("src"),a.remove(),j({type:"reset"}),n()})),a.addEventListener("error",(function(){c()}))}))}))}))};return{speakSynthesis:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";O(),e({id:p(),task:function(){return y(x(t),t)}})},getText:function(){return g.current},getAudioLevel:function(){return m.current}}},_=function(){var e=w({sockUrl:"http://localhost:5005/socket.io/",sockOpts:{transports:["websocket"]},onUtter:function(e){o(e.text)}}),t=e.send,n=e.triggerRestartSession,c=N((function(e){t(e)}),(function(){o("I am sorry. I cannot hear you. Please speak louder and clearer.")})),r=c.startRecognize,s=c.getListening,a=U(),o=a.speakSynthesis;return{getText:a.getText,getAudioLevel:a.getAudioLevel,startRecognize:r,triggerRestartSession:n,getListening:s}},C=(n(364),function(){return Object(g.jsx)("div",{className:"cheat-card",children:Object(g.jsx)("div",{className:"card",children:Object(g.jsxs)("div",{className:"card-body",children:[Object(g.jsx)("h5",{className:"card-title",children:"Quick Guide"}),Object(g.jsx)("h6",{className:"card-subtitle mb-2 text-muted",children:"Simple guide to get started using the system"}),Object(g.jsxs)("ul",{className:"list-group card-text",children:[Object(g.jsxs)("li",{className:"list-group-item",children:[Object(g.jsx)("h6",{children:"What...?"}),Object(g.jsx)("p",{className:"small",children:"Ask the explanation of many things related to the CS School such as the current Dean, computer science meaning or major subjects."})]}),Object(g.jsxs)("li",{className:"list-group-item",children:[Object(g.jsx)("h6",{children:"Where...?"}),Object(g.jsx)("p",{className:"small",children:"Ask the direction to many places in the CS School such as Dean's Office, School Office or Surau."})]}),Object(g.jsxs)("li",{className:"list-group-item",children:[Object(g.jsx)("h6",{children:"Why / How...?"}),Object(g.jsx)("p",{className:"small",children:"Inquiry about many subjects about the CS School such as the reasoning behind internship programme, graduate requirements or and others."})]})]})]})})})}),D=n.p+"static/media/usmlogocut.908cfbbb.png",z=function(){return Object(g.jsx)("div",{className:"usm_logo",children:Object(g.jsx)("img",{src:D,alt:"USM | Universiti Sains Malaysia - Logo"})})};d.a.registerPlugin(f.b),b.Live2DModel.registerTicker(f.a);var P=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useRef)(),r=Object(c.useRef)(),s=Object(c.useState)(!1),a=Object(l.a)(s,2),o=a[0],f=a[1],j=_(),p=j.getText,O=j.getAudioLevel,v=j.startRecognize,x=j.getListening;h()(Object(u.a)(i.a.mark((function c(){return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return n.current=new d.a({view:t.current,autoStart:!0,resizeTo:e.current,transparent:!0}),c.next=3,b.Live2DModel.from("chitose/chitose.model3.json").then((function(e){e.scale.set(.3);var t=e.internalModel.motionManager.update;e.internalModel.motionManager.update=function(){for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];t.apply(e.internalModel.motionManager,c),e.internalModel.coreModel.setParameterValueById("PARAM_MOUTH_OPEN_Y",O())},n.current.stage.addChild(e),r.current=e,n.current.stage.children[0].x=n.current.stage.width/2,n.current.stage.children[0].y=.05*n.current.stage.height}));case 3:case"end":return c.stop()}}),c)}))),[]);return console.log(x()),Object(g.jsxs)("div",{className:"live2d-viewer",ref:e,children:[Object(g.jsx)("canvas",{ref:t}),Object(g.jsx)(m,{text:p()}),Object(g.jsx)(z,{}),Object(g.jsx)("div",{className:"card speak-tutor",hidden:o,children:'\xa0\u2190\xa0Click this button and say "Hi" to begin conversation!'}),Object(g.jsx)("button",{className:"btn btn-lg btn-light speak-btn",onClick:function(e){f(!0),function(e){e.preventDefault(),v()}(e)},children:Object(g.jsx)("b",{children:"SPEAK"})}),Object(g.jsx)(C,{})]})},T=function(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(P,{})})};a.a.render(Object(g.jsx)(r.a.StrictMode,{children:Object(g.jsx)(T,{})}),document.getElementById("root"))},42:function(e,t){},48:function(e,t){}},[[365,1,2]]]);
//# sourceMappingURL=main.7b5264da.chunk.js.map