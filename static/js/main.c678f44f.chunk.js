(this["webpackJsonpfushigi-user-interface"]=this["webpackJsonpfushigi-user-interface"]||[]).push([[0],{162:function(e,t){},164:function(e,t){},166:function(e,t){},167:function(e,t){},168:function(e,t){},169:function(e,t){},203:function(e,t,n){},328:function(e,t,n){},354:function(e,t){},363:function(e,t,n){},364:function(e,t,n){"use strict";n.r(t);var r=n(10),c=n.n(r),o=n(157),s=n.n(o),a=(n(198),n(201),n(1)),i=n.n(a),u=n(66),l=(n(203),n(101)),d=n(34),f=n(102),b=n(158),j=n.n(b),h=(n(328),n(12)),p=function(e){return Object(h.jsx)("div",{className:"subtitle-text mx-auto text-center",children:Object(h.jsx)("p",{children:""!==e.text?Object(h.jsx)("span",{children:e.text}):null})})},m=n(71),O=n(37),g=n(159),v=n.n(g),x=function(){return null},w=["error","connect_error","connect_timeout","reconnect_error","reconnect_failed","disconnect"],y=function(e){var t=e.sockUrl,n=e.sockOpts,c=e.initSessionId,o=e.initMsg,s=e.onError,a=void 0===s?x:s,l=e.onUtter,d=void 0===l?x:l,f=Object(r.useRef)(null),b=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=t.match(/^((?:http|ws)s?:\/\/[^/]+)(\/.*)$/),r=Object(O.a)(e,3),s=r[1],i=r[2],u=v()(s,Object(m.a)({path:i},n));return f.current=u,w.forEach((function(e){return u.on(e,(function(t){"disconnect"===e&&"io client disconnect"===t||a({type:e,payload:t})}))})),u.on("connect",(function(){return j(u,c)})).on("session_confirm",(function(e){b.current=e,console.log("New session created! : "+b.current+"/"+e),o&&y(o)})).on("bot_uttered",y),function(){return u.close()}}),[]);var j=Object(r.useCallback)((function(e,t){return f.current.emit("session_request",{session_id:t})}),[]),h=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.current,e.next=3,t.close();case 3:return e.next=5,t.open();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=Object(r.useCallback)((function(e,t){f.current.emit("user_uttered",{session_id:b.current,message:t||e})}),[]),g=Object(r.useCallback)((function(e){p(e)}),[p]),y=Object(r.useCallback)((function(e){var t={ts:Date.now(),direction:"in",metadata:e.metadata};d(Object(m.a)(Object(m.a)({},t),e))}),[d]);return{send:g,botUtter:y,restartSession:j,triggerRestartSession:h}},S=n(378),k=n(369),R=n(379),A=n(75),N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null},n=Object(r.useState)(null),c=Object(O.a)(n,2),o=c[0],s=c[1],a=Object(r.useReducer)((function(e,t){switch(t.type){case"start":return!0;case"stop":return!1;default:throw new Error("Unexpected action")}}),!1,void 0),i=Object(O.a)(a,2),u=i[0],l=i[1],d=Object(r.useRef)(!1);Object(r.useEffect)((function(){d.current=u}),[u]);var f=function(){return new Promise((function(n,r){var c=S.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),o=k.a.fromDefaultMicrophoneInput(),a=new R.a(c,o);console.log("Voice recognition started."),l({type:"start"}),a.recognizeOnceAsync((function(c){var o;c.reason===A.a.RecognizedSpeech?o=c.text:(o="Speech was cancelled or could not be recognized. Ensure your microphone is working properly.",t(),r()),l({type:"stop"}),console.log("Final result: "+o),s(o),e(o),n()}))}))},b=function(){return d.current};return{transcript:o,startRecognize:f,getListening:b}},M=n(19),E=n(170),U=n(377),_=function(){var e=Object(E.a)({concurrency:1}).add,t=Object(r.useState)(0),n=Object(O.a)(t,2),c=n[0],o=n[1],s=Object(r.useState)(""),a=Object(O.a)(s,2),i=a[0],u=a[1],l=Object(r.useReducer)((function(e,t){switch(t.type){case"set":return t.payload;case"reset":return 0;default:throw new Error("Unexpected action")}}),0),d=Object(O.a)(l,2),f=d[0],b=d[1],j=Object(r.useRef)(0),h=Object(r.useRef)(""),p=Object(r.useRef)(0);Object(r.useEffect)((function(){p.current=f}),[f]);Object(r.useEffect)((function(){j.current=c}),[c]),Object(r.useEffect)((function(){h.current=i}),[i]);var m=function(){return j.current},g=function(){o(c+1)},v=function(e){return'<speak version="1.0" xmlns="https://www.w3.org/2001/10/synthesis" xml:lang="en-US">\n  <voice name="en-US-GuyRUS">\n    '.concat(e,"\n  </voice>\n</speak>")},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise((function(t,n){var r=S.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),c=new U.a(r,null);c.speakSsmlAsync(v(e),(function(e){c.close(),t(e.audioData)}),(function(e){console.log(e),c.close(),n(e)}))}))},w=function(e,t){return new Promise((function(n,r){var c=new AudioContext;e.then((function(e){var o=new Blob([e],{type:"audio/wav"}),s=new Audio(window.URL.createObjectURL(o));s.play().then((function(){u(t);var e,o=s.captureStream(),a=c.createAnalyser(),i=c.createMediaStreamSource(o),l=new Float32Array(a.fftSize);i.connect(a);!function t(){a.getFloatTimeDomainData(l);var n,r=0,c=Object(M.a)(l);try{for(c.s();!(n=c.n()).done;){var o=n.value;r+=o*o}}catch(s){c.e(s)}finally{c.f()}b({type:"set",payload:(5*Math.sqrt(r/l.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),s.addEventListener("ended",(function(){u(""),i.disconnect(),a.disconnect(),cancelAnimationFrame(e),s.pause(),s.removeAttribute("src"),s.remove(),b({type:"reset"}),n()})),s.addEventListener("error",(function(){r()}))}))}))}))};return{speakSynthesis:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";g(),e({id:m(),task:function(){return w(x(t),t)}})},getText:function(){return h.current},getAudioLevel:function(){return p.current}}},C=function(){var e=y({sockUrl:"http://localhost:5005/socket.io/",sockOpts:{transports:["websocket"]},onUtter:function(e){o(e.text)}}),t=e.send,n=e.triggerRestartSession,r=N((function(e){t(e)}),(function(){o("I am sorry. I cannot hear you. Please speak louder and clearer.")})).startRecognize,c=_(),o=c.speakSynthesis;return{getText:c.getText,getAudioLevel:c.getAudioLevel,startRecognize:r,triggerRestartSession:n}},L=(n(363),function(){return Object(h.jsx)("div",{className:"cheat-card",children:Object(h.jsx)("div",{className:"card",children:Object(h.jsxs)("div",{className:"card-body",children:[Object(h.jsx)("h5",{className:"card-title",children:"Quick Guide"}),Object(h.jsx)("h6",{className:"card-subtitle mb-2 text-muted",children:"Simple guide to get started using the system"}),Object(h.jsxs)("ul",{className:"list-group card-text",children:[Object(h.jsxs)("li",{className:"list-group-item",children:[Object(h.jsx)("h6",{children:"What...?"}),Object(h.jsx)("p",{className:"small",children:"Ask the explanation of many things related to the CS School such as the current Dean, computer science meaning or major subjects."})]}),Object(h.jsxs)("li",{className:"list-group-item",children:[Object(h.jsx)("h6",{children:"Where...?"}),Object(h.jsx)("p",{className:"small",children:"Ask the direction to many places in the CS School such as Dean's Office, School Office or Surau."})]}),Object(h.jsxs)("li",{className:"list-group-item",children:[Object(h.jsx)("h6",{children:"Why / How...?"}),Object(h.jsx)("p",{className:"small",children:"Inquiry about many subjects about the CS School such as the reasoning behind internship programme, graduate requirements or and others."})]})]})]})})})});l.a.registerPlugin(d.b),f.Live2DModel.registerTicker(d.a);var D=function(){var e=Object(r.useRef)(),t=Object(r.useRef)(),n=Object(r.useRef)(),c=Object(r.useRef)(),o=C(),s=o.getText,a=o.getAudioLevel,d=o.startRecognize;j()(Object(u.a)(i.a.mark((function r(){return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.current=new l.a({view:t.current,autoStart:!0,backgroundColor:16770974,resizeTo:e.current}),r.next=3,f.Live2DModel.from("chitose/chitose.model3.json").then((function(e){e.scale.set(.3);var t=e.internalModel.motionManager.update;e.internalModel.motionManager.update=function(){for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];t.apply(e.internalModel.motionManager,r),e.internalModel.coreModel.setParameterValueById("PARAM_MOUTH_OPEN_Y",a())},n.current.stage.addChild(e),c.current=e,n.current.stage.children[0].x=n.current.stage.width/2}));case 3:case"end":return r.stop()}}),r)}))),[]);return Object(h.jsxs)("div",{className:"live2d-viewer",ref:e,children:[Object(h.jsx)("canvas",{ref:t}),Object(h.jsx)(p,{text:s()}),Object(h.jsx)("button",{className:"btn btn-lg btn-primary speak-btn",onClick:function(e){e.preventDefault(),d()},children:"SPEAK"}),Object(h.jsx)(L,{})]})},z=function(){return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(D,{})})};s.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(z,{})}),document.getElementById("root"))},43:function(e,t){},53:function(e,t){}},[[364,1,2]]]);
//# sourceMappingURL=main.c678f44f.chunk.js.map