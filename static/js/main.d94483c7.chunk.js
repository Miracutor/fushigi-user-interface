(this["webpackJsonpfushigi-user-interface"]=this["webpackJsonpfushigi-user-interface"]||[]).push([[0],{162:function(e,t){},164:function(e,t){},166:function(e,t){},167:function(e,t){},168:function(e,t){},169:function(e,t){},203:function(e,t,n){},328:function(e,t,n){},354:function(e,t){},363:function(e,t,n){},364:function(e,t,n){"use strict";n.r(t);var r=n(10),c=n.n(r),a=n(157),o=n.n(a),i=(n(198),n(201),n(1)),s=n.n(i),u=n(66),l=(n(203),n(101)),d=n(35),f=n(102),b=n(18),h=n(34),m=function(){var e=Object(r.useReducer)((function(e,t){switch(t.type){case"set":return t.payload;case"reset":return 0;default:throw new Error("Unexpected action")}}),0),t=Object(h.a)(e,2),n=t[0],c=t[1],a=Object(r.useRef)(0);Object(r.useEffect)((function(){a.current=n}),[n]);return{playSound:function(e){var t=new AudioContext,n=new Audio(e);n.play().then((function(){var e,r=n.captureStream(),a=t.current.createAnalyser(),o=t.current.createMediaStreamSource(r),i=new Float32Array(a.fftSize);o.connect(a);!function t(){a.getFloatTimeDomainData(i);var n,r=0,o=Object(b.a)(i);try{for(o.s();!(n=o.n()).done;){var s=n.value;r+=s*s}}catch(u){o.e(u)}finally{o.f()}c({type:"set",payload:(5*Math.sqrt(r/i.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),n.addEventListener("ended",(function(){o.disconnect(),a.disconnect(),cancelAnimationFrame(e),n.pause(),n.removeAttribute("src"),n.remove(),c({type:"reset"})}))}))},playSoundBeta:function(e,t){return new Promise((function(n,r){var a=new AudioContext,o=new Audio('http://localhost:5252/api/tts?text="'.concat(e,'"'));o.crossOrigin="anonymous",o.preload="auto",a.resume().then(o.play().then((function(){t(e);var i,s=o.captureStream(),u=a.createAnalyser(),l=a.createMediaStreamSource(s),d=new Float32Array(u.fftSize);l.connect(u);!function e(){u.getFloatTimeDomainData(d);var t,n=0,r=Object(b.a)(d);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a*a}}catch(o){r.e(o)}finally{r.f()}c({type:"set",payload:(5*Math.sqrt(n/d.length)).toFixed(1)}),i=requestAnimationFrame(e)}(),o.addEventListener("ended",(function(){t(""),l.disconnect(),u.disconnect(),cancelAnimationFrame(i),o.pause(),o.removeAttribute("src"),o.remove(),c({type:"reset"}),n()})),o.addEventListener("error",(function(){r()}))})))}))},playSoundOmega:function(e,t,n){return new Promise((function(r,a){var o=new AudioContext;e.then((function(e){var i=new Blob([e],{type:"audio/wav"}),s=new Audio(window.URL.createObjectURL(i));s.play().then((function(){n(t);var e,i=s.captureStream(),u=o.createAnalyser(),l=o.createMediaStreamSource(i),d=new Float32Array(u.fftSize);l.connect(u);!function t(){u.getFloatTimeDomainData(d);var n,r=0,a=Object(b.a)(d);try{for(a.s();!(n=a.n()).done;){var o=n.value;r+=o*o}}catch(i){a.e(i)}finally{a.f()}c({type:"set",payload:(5*Math.sqrt(r/d.length)).toFixed(1)}),e=requestAnimationFrame(t)}(),s.addEventListener("ended",(function(){n(""),l.disconnect(),u.disconnect(),cancelAnimationFrame(e),s.pause(),s.removeAttribute("src"),s.remove(),c({type:"reset"}),r()})),s.addEventListener("error",(function(){a()}))}))}))}))},getAudioLevel:function(){return a.current}}},j=n(158),p=n.n(j),v=(n(328),n(12)),O=function(e){return Object(v.jsx)("div",{className:"subtitle-text mx-auto text-center",children:Object(v.jsx)("p",{children:""!==e.text?Object(v.jsx)("span",{children:e.text}):null})})},g=n(71),y=n(159),x=n.n(y),w=function(){return null},S=["error","connect_error","connect_timeout","reconnect_error","reconnect_failed","disconnect"],A=function(e){var t=e.sockUrl,n=e.sockOpts,c=e.initSessionId,a=e.initMsg,o=e.onError,i=void 0===o?w:o,l=e.onUtter,d=void 0===l?w:l,f=Object(r.useRef)(null),b=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=t.match(/^((?:http|ws)s?:\/\/[^/]+)(\/.*)$/),r=Object(h.a)(e,3),o=r[1],s=r[2],u=x()(o,Object(g.a)({path:s},n));return f.current=u,S.forEach((function(e){return u.on(e,(function(t){"disconnect"===e&&"io client disconnect"===t||i({type:e,payload:t})}))})),u.on("connect",(function(){return m(u,c)})).on("session_confirm",(function(e){b.current=e,console.log("New session created! : "+b.current+"/"+e),a&&O(a)})).on("bot_uttered",O),function(){return u.close()}}),[]);var m=Object(r.useCallback)((function(e,t){return f.current.emit("session_request",{session_id:t})}),[]),j=function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.current,e.next=3,t.close();case 3:return e.next=5,t.open();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=Object(r.useCallback)((function(e,t){f.current.emit("user_uttered",{session_id:b.current,message:t||e})}),[]),v=Object(r.useCallback)((function(e){p(e)}),[p]),O=Object(r.useCallback)((function(e){var t={ts:Date.now(),direction:"in",metadata:e.metadata};d(Object(g.a)(Object(g.a)({},t),e))}),[d]);return{send:v,botUtter:O,restartSession:m,triggerRestartSession:j}},k=n(378),R=n(369),M=n(379),E=n(75),N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null},n=Object(r.useState)(null),c=Object(h.a)(n,2),a=c[0],o=c[1],i=Object(r.useReducer)((function(e,t){switch(t.type){case"start":return!0;case"stop":return!1;default:throw new Error("Unexpected action")}}),!1,void 0),s=Object(h.a)(i,2),u=s[0],l=s[1],d=Object(r.useRef)(!1);Object(r.useEffect)((function(){d.current=u}),[u]);var f=function(){return new Promise((function(n,r){var c=k.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),a=R.a.fromDefaultMicrophoneInput(),i=new M.a(c,a);console.log("Voice recognition started."),l({type:"start"}),i.recognizeOnceAsync((function(c){var a;c.reason===E.a.RecognizedSpeech?a=c.text:(a="Speech was cancelled or could not be recognized. Ensure your microphone is working properly.",t(),r()),l({type:"stop"}),console.log("Final result: "+a),o(a),e(a),n()}))}))},b=function(){return d.current};return{transcript:a,startRecognize:f,getListening:b}},F=n(170),D=n(377),C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=Object(F.a)({concurrency:1}),n=t.add,c=Object(r.useState)(0),a=Object(h.a)(c,2),o=a[0],i=a[1],s=Object(r.useState)(""),u=Object(h.a)(s,2),l=u[0],d=u[1],f=Object(r.useRef)(0),b=Object(r.useRef)("");Object(r.useEffect)((function(){f.current=o}),[o]),Object(r.useEffect)((function(){b.current=l}),[l]);var m=function(){return f.current},j=function(){return b.current},p=function(){i(o+1)},v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";p(),n({id:m(),task:function(){return e(g(t),t,d)}})},O=function(e){return'<speak version="1.0" xmlns="https://www.w3.org/2001/10/synthesis" xml:lang="en-US">\n  <voice name="en-US-GuyRUS">\n    '.concat(e,"\n  </voice>\n</speak>")},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise((function(t,n){var r=k.a.fromSubscription("6a15144b41b74b66bd68b9d11d2ba8cd","southeastasia"),c=new D.a(r,null);c.speakSsmlAsync(O(e),(function(e){c.close(),t(e.audioData)}),(function(e){console.log(e),c.close(),n(e)}))}))};return{speakSynthesis:v,getText:j}},U=function(e){var t=A({sockUrl:"http://localhost:5005/socket.io/",sockOpts:{transports:["websocket"]},onUtter:function(e){o(e.text)}}),n=t.send,r=t.triggerRestartSession,c=N((function(e){n(e)}),(function(){o("I am sorry. I cannot hear you. Please speak louder and clearer.")})).startRecognize,a=C(e),o=a.speakSynthesis;return{getText:a.getText,startRecognize:c,triggerRestartSession:r}},_=(n(363),function(){return Object(v.jsx)("div",{className:"cheat-card",children:Object(v.jsx)("div",{className:"card",children:Object(v.jsxs)("div",{className:"card-body",children:[Object(v.jsx)("h5",{className:"card-title",children:"Quick Guide"}),Object(v.jsx)("h6",{className:"card-subtitle mb-2 text-muted",children:"Simple guide to get started using the system"}),Object(v.jsxs)("ul",{className:"list-group card-text",children:[Object(v.jsxs)("li",{className:"list-group-item",children:[Object(v.jsx)("h6",{children:"What...?"}),Object(v.jsx)("p",{className:"small",children:"Ask the explanation of many things related to the CS School such as the current Dean, computer science meaning or major subjects."})]}),Object(v.jsxs)("li",{className:"list-group-item",children:[Object(v.jsx)("h6",{children:"Where...?"}),Object(v.jsx)("p",{className:"small",children:"Ask the direction to many places in the CS School such as Dean's Office, School Office or Surau."})]}),Object(v.jsxs)("li",{className:"list-group-item",children:[Object(v.jsx)("h6",{children:"Why / How...?"}),Object(v.jsx)("p",{className:"small",children:"Inquiry about many subjects about the CS School such as the reasoning behind internship programme, graduate requirements or and others."})]})]})]})})})});l.a.registerPlugin(d.b),f.Live2DModel.registerTicker(d.a);var L=function(){var e=Object(r.useRef)(),t=Object(r.useRef)(),n=Object(r.useRef)(),c=Object(r.useRef)(),a=m(),o=a.playSoundOmega,i=a.getAudioLevel,d=U(o),b=d.getText,h=d.startRecognize;p()(Object(u.a)(s.a.mark((function r(){return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.current=new l.a({view:t.current,autoStart:!0,backgroundColor:16770974,resizeTo:e.current}),r.next=3,f.Live2DModel.from("chitose/chitose.model3.json").then((function(e){e.scale.set(.3);var t=e.internalModel.motionManager.update;e.internalModel.motionManager.update=function(){for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];t.apply(e.internalModel.motionManager,r),e.internalModel.coreModel.setParameterValueById("PARAM_MOUTH_OPEN_Y",i())},n.current.stage.addChild(e),c.current=e,n.current.stage.children[0].x=n.current.stage.width/2}));case 3:case"end":return r.stop()}}),r)}))),[]);return Object(v.jsxs)("div",{className:"live2d-viewer",ref:e,children:[Object(v.jsx)("canvas",{ref:t}),Object(v.jsx)(O,{text:b()}),Object(v.jsx)("button",{className:"btn btn-lg btn-primary speak-btn",onClick:function(e){e.preventDefault(),h()},children:"SPEAK"}),Object(v.jsx)(_,{})]})},z=function(){return Object(v.jsx)("div",{className:"App",children:Object(v.jsx)(L,{})})};o.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(z,{})}),document.getElementById("root"))},43:function(e,t){},53:function(e,t){}},[[364,1,2]]]);
//# sourceMappingURL=main.d94483c7.chunk.js.map